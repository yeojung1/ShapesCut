<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  <title>Shapes Cut!</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: black;
    }

    #ui-container {
      width: 1280px;
      height: 80px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 20px;
      box-sizing: border-box;
      padding: 0 5px;
      background-color: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255,255,255,0.2);
      position: relative;
    }

    #game-container {
      position: relative;
      width: 1280px;
      height: 640px;
      background: transparent;
      border: 1px solid rgba(0, 153, 255, 0.4);
      box-shadow:
        0 0 10px rgba(0, 153, 255, 0.6),
        0 0 20px rgba(0, 153, 255, 0.5),
        0 0 25px rgba(0, 153, 255, 0.4),
        0 0 30px rgba(0, 153, 255, 0.2);
      border-radius: 5px;
      cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><circle cx="8" cy="8" r="3" fill="white"/></svg>') 8 8, auto;
      transition: box-shadow 0.3s ease;
    }

    #game-container.combo-reset {
      border-color: rgba(255, 0, 0, 0.4);
      box-shadow:
        0 0 10px rgba(255, 0, 0, 0.6),
        0 0 20px rgba(255, 0, 0, 0.5),
        0 0 25px rgba(255, 0, 0, 0.4),
        0 0 30px rgba(255, 0, 0, 0.2);
    }

    #game-container canvas {
      display: block;
    }

    #combo-text{
      position:absolute;
      top:10px;
      right:20px;
      color:#00baff;
      font-family:'Orbitron', sans-serif;
      font-size:20px;
      font-weight:800;
      letter-spacing:1px;
      opacity:0;
      transition: opacity 0.2s ease-out, transform 0.2s ease-out;
      text-shadow:0 0 10px rgba(0,180,255,0.6);
      pointer-events:none;
      user-select:none;
    }

    .ui-score {
      font-family: 'Orbitron';
      font-size: 25px;
      font-weight: 400;
      letter-spacing: 1.5px;
      text-shadow:
        0 0 10px rgba(0, 153, 255, 0.5),
        0 0 20px rgba(0, 153, 255, 0.4),
        0 0 25px rgba(0, 153, 255, 0.3),
        0 0 30px rgba(0, 153, 255, 0.2);
    }

    .ui-timer{
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 1ch;
      font-family: 'Orbitron', system-ui, sans-serif;
      letter-spacing: 3px;
      font-size: 25px;
      text-shadow:
        0 0 10px rgba(0, 153, 255, 0.5),
        0 0 20px rgba(0, 153, 255, 0.4),
        0 0 25px rgba(0, 153, 255, 0.3),
        0 0 30px rgba(0, 153, 255, 0.2);
      margin-left: auto;
    }

    .ui-timer > span{ text-align:center; }

    .ui-title {
      font-family: 'Orbitron', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      font-weight: 800;
      font-size: 40px;
      letter-spacing: 1.5px;
      background: linear-gradient(90deg, #71c4ff, #6dacff 40%);
      -webkit-background-clip: text;
      background-clip: text; 
      color: transparent;
      text-shadow:
        0 0 10px rgba(0, 153, 255, 0.3),
        0 0 20px rgba(0, 153, 255, 0.2),
        0 0 25px rgba(0, 153, 255, 0.1),
        0 0 30px rgba(0, 153, 255, 0.1);
      user-select: none;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .ui-button {
      font-family: 'Segoe UI Symbol', 'Orbitron', sans-serif;
      font-weight: 1000;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 30px;
      margin-left: 20px;
      transition:
        opacity 0.15s ease,
        text-shadow 0.3s ease,
        transform 0.15s ease;
      text-shadow: none;
    }

    .ui-button:hover {
      opacity: 1;
      text-shadow:
        0 0 10px rgba(0, 153, 255, 0.5),
        0 0 20px rgba(0, 153, 255, 0.4),
        0 0 25px rgba(0, 153, 255, 0.3),
        0 0 30px rgba(0, 153, 255, 0.2);
      transform: scale(1.05);
    }

    .ui-button:active {
      opacity: 0.7;
      transform: scale(0.97);
    }

    /* Ïò§Î≤ÑÎ†àÏù¥ Ïä§ÌÉÄÏùº */
    #overlay-modal { border:none; padding:0; margin:0; width:100vw; height:100vh; background:transparent; }
    #overlay-modal::backdrop { background: rgba(0,0,0,0.9); backdrop-filter: blur(2px); }
    .modal-wrap { position:absolute; inset:0; display:grid; place-items:center; }
    .panel {
      width:min(720px,92vw); min-height:300px; max-height:80vh; overflow:auto;
      border: none;
      box-shadow: none; 
    }
    .modal-close{ position:absolute; top:18px; right:22px; background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.16); color:#e7f6ff; border-radius:10px; font-weight:700;
      padding:6px 10px; cursor:pointer;}
    .modal-close:hover{ background: rgba(255,255,255,0.12); }
  </style>
</head>
<body>
  <!-- üî∂ Í≥µÏö© Ïò§Î≤ÑÎ†àÏù¥ (ÌÖúÌîåÎ¶ø Í∏∞Î∞ò) -->
  <dialog id="overlay-modal">
    <div class="modal-wrap">
      <div id="overlay-panel" class="panel"></div>
      <button class="modal-close" id="overlay-close" aria-label="close">‚úï</button>
    </div>
  </dialog>

  <!-- ‚è∏ stop_menu ÌÖúÌîåÎ¶ø -->
  <template id="tpl-stop_menu">
    <div class="wrap" style="min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px;font-family:'Orbitron',sans-serif;color:#e6f7ff;">
      <div class="card" style="width:480px;max-width:92vw;background:rgba(255,255,255,0.04);border:1px solid rgba(0,153,255,0.3);box-shadow:0 0 10px rgba(0,153,255,0.35),0 0 22px rgba(0,153,255,0.22);border-radius:12px;padding:28px 26px 24px;text-align:center;">
        <h1 style="margin:0 0 6px;font-size:38px;letter-spacing:2px;background:linear-gradient(90deg,#71c4ff,#6dacff 40%);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 10px rgba(0,153,255,0.25);">PAUSED</h1>
        <p style="margin:6px 0 18px;opacity:.8;font-size:15px;">Í≤åÏûÑÏù¥ ÏùºÏãúÏ†ïÏßÄÎêòÏóàÏäµÎãàÎã§.</p>
        <div class="actions" style="display:flex;flex-direction:column;gap:12px;">
          <button class="btn" data-action="resume">RESUME</button>
          <button class="btn" data-action="restart">RESTART</button>
          <button class="btn" data-action="main">Main</button>
        </div>
      </div>
    </div>
    <style>
      .btn{background:transparent;color:#e8f6ff;border:1px solid rgba(0,153,255,0.5);border-radius:10px;padding:12px 10px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:800;letter-spacing:1px;font-size:16px;transition:transform .12s,box-shadow .2s,background .2s,border-color .2s;}
      .btn:hover{transform:translateY(-1px);box-shadow:0 0 14px rgba(0,153,255,0.45);border-color:rgba(0,153,255,0.9);background:rgba(0,153,255,0.08);}
    </style>
  </template>

  <!-- üèÅ result ÌÖúÌîåÎ¶ø --> 
  <template id="tpl-result">
    <div class="wrap" style="min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px;font-family:'Orbitron',sans-serif;color:#e6f7ff;">
      <div class="card" style="width:520px;max-width:92vw;background:rgba(255,255,255,0.04);border:1px solid rgba(0,153,255,0.3);box-shadow:0 0 10px rgba(0,153,255,0.4),0 0 24px rgba(0,153,255,0.25);border-radius:12px;padding:28px 28px 22px;text-align:center;">
        <h1 style="margin:0 0 10px;font-size:40px;letter-spacing:2px;background:linear-gradient(90deg,#71c4ff,#6dacff 40%);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 10px rgba(0,153,255,0.25);">RESULT</h1>
        <div class="score" style="margin:8px 0 18px;font-size:18px;opacity:.85;">Your Score</div>
        <div id="ov-score" class="big" style="font-size:64px;font-weight:800;margin:10px 0 8px;text-shadow:0 0 16px rgba(0,153,255,0.5);">0</div>

        <!-- üîπ Ïó¨Í∏∞ Ï∂îÍ∞Ä: BEST Ï†êÏàò ÌëúÏãú -->
        <div class="best" style="margin:4px 0 18px;font-size:20px;opacity:.9;">
          BEST : <span id="ov-best">0</span>
        </div>

        <div class="actions" style="display:flex;gap:12px;justify-content:center;margin-top:10px;">
          <button class="btn" data-action="restart">PLAY AGAIN</button>
          <button class="btn" data-action="main">Main</button>
        </div>
      </div>
    </div>
    <style>
      .btn{flex:1;background:transparent;color:#e8f6ff;border:1px solid rgba(0,153,255,0.5);border-radius:10px;padding:12px 10px;cursor:pointer;font-family:'Orbitron',sans-serif;font-weight:800;letter-spacing:1px;font-size:16px;transition:transform .12s,box-shadow .2s,background .2s,border-color .2s;}
      .btn:hover{transform:translateY(-1px);box-shadow:0 0 14px rgba(0,153,255,0.45);border-color:rgba(0,153,255,0.9);background:rgba(0,153,255,0.08);}
    </style>
  </template>


  <!-- ÏúÑÏ™Ω UI ÏòÅÏó≠ -->
  <div id="ui-container">
    <div class="ui-score" style="position: relative; top: 10px;">SCORE: 0</div>
    <div class="ui-title">Cut Shapes!</div>
    <div class="ui-timer" id="timer" style="position: relative; right: 50px; top: 10px;">1:00</div>
    <button class="ui-button" style="position: relative; top: 6px;">&#x23F8;&#xFE0E;</button>
  </div>

  <!-- ÏïÑÎûòÏ™Ω Í≤åÏûÑ ÏòÅÏó≠ -->
  <div id="game-container">
    <div id="combo-text"></div>
  </div>

  <!-- ÌÉÄÏù¥Î®∏ Í∏ÄÏûê spanÏúºÎ°ú Ï™ºÍ∞úÍ∏∞ -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('timer');
      if (!el) return;
      el.innerHTML = [...el.textContent].map(ch => `<span>${ch}</span>`).join('');
    });
  </script>

  <!-- three.js + Í≤åÏûÑ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
  <script src="three.min.js"></script>
  <script src="ShapesMove.js"></script>
  <script src="ShapeCutter.js"></script>

  <!-- Ïò§Î≤ÑÎ†àÏù¥ Î°úÏßÅ -->
  <script>
    const dlg = document.getElementById('overlay-modal');
    const panel = document.getElementById('overlay-panel');
    const closeBtn = document.getElementById('overlay-close');

    function bindPanelActions() {
      panel.querySelectorAll('[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const a = btn.getAttribute('data-action');
          if (a === 'resume') { closeOverlay(); window.resumeGame?.(); }
          if (a === 'restart') { location.reload(); }
          if (a === 'toResult') { openOverlay('result'); }
          if (a === 'main') { location.href = "index.html"; }
          if (a === 'close') { closeOverlay(); }
        });
      });
    }

    function openOverlay(kind){
      const tplId = kind === 'result' ? 'tpl-result' : 'tpl-stop_menu';
      const tpl = document.getElementById(tplId);
      panel.innerHTML = tpl.innerHTML;

      if (tplId === 'tpl-result') {
        // ÎßàÏßÄÎßâ Ï†êÏàò Í∞ÄÏ†∏Ïò§Í∏∞
        const last = Number(localStorage.getItem('lastScore') || '0');

        // Ïù¥Ï†ÑÍπåÏßÄÏùò ÏµúÍ≥† Ï†êÏàò Í∞ÄÏ†∏Ïò§Í∏∞
        const prevBest = Number(localStorage.getItem('bestScore') || '0');

        // Ïù¥Î≤à ÎùºÏö¥ÎìúÍπåÏßÄ Ìè¨Ìï®Ìï¥ÏÑú ÏµúÍ≥† Ï†êÏàò Í≥ÑÏÇ∞
        const best = Math.max(last, prevBest);

        // localStorageÏóê ÏµúÍ≥† Í∏∞Î°ù Ï†ÄÏû•
        localStorage.setItem('bestScore', String(best));

        // Í≤∞Í≥º ÌåùÏóÖÏóê Î∞òÏòÅ
        const ov = panel.querySelector('#ov-score');
        if (ov) ov.textContent = last;

        const bestEl = panel.querySelector('#ov-best');
        if (bestEl) bestEl.textContent = best;
      }


      bindPanelActions();
      if (!dlg.open) dlg.showModal();
    }

    function closeOverlay(){
      if (dlg.open) dlg.close();
      panel.innerHTML = '';
    }

    window.openOverlay = openOverlay;
    window.closeOverlay = closeOverlay;

    closeBtn?.addEventListener('click', () => {
      closeOverlay();
      // window.resumeGame?.();
    });

  localStorage.setItem('lastScore', currentScore);
  openOverlay('result');

  </script>
</body>
</html>
